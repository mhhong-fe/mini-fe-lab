<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Canvas 图像操作 Demo</title>
<style>
  body {
    background: #111;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    margin: 0;
    color: white;
  }
  canvas {
    background: #222;
    margin-top: 20px;
    display: block;
  }
</style>
</head>
<body>
<h2>Canvas 图像操作 Demo</h2>
<canvas id="demoCanvas" width="600" height="400"></canvas>

<script>
const canvas = document.getElementById('demoCanvas');
const ctx = canvas.getContext('2d');

const img = new Image();
img.src = 'https://picsum.photos/300/200'; // 测试图片
img.crossOrigin = "anonymous";

img.onload = () => {
    const W = canvas.width;
    const H = canvas.height;

    ctx.clearRect(0,0,W,H);

    // --------------------------
    // 1. 缩放 + 平移 + 旋转
    ctx.save();
    ctx.translate(150,100); // 平移
    ctx.rotate(Math.PI/8);  // 旋转
    ctx.drawImage(img, -75, -50, 150, 100); // 缩放绘制
    ctx.restore();

    // --------------------------
    // 2. 裁剪成圆形
    ctx.save();
    ctx.beginPath();
    ctx.arc(450, 100, 50, 0, Math.PI*2);
    ctx.clip();
    ctx.drawImage(img, 400, 50, 100, 100);
    ctx.restore();

    // --------------------------
    // 3. 灰度像素处理
    const imageData = ctx.getImageData(250, 200, 300, 150);
    const data = imageData.data;
    for(let i=0;i<data.length;i+=4){
        const avg = (data[i]+data[i+1]+data[i+2])/3;
        data[i]=data[i+1]=data[i+2]=avg;
    }
    ctx.putImageData(imageData, 250, 200);

    // --------------------------
    // 4. 滤镜 + 透明叠加
    ctx.save();
    ctx.globalAlpha = 0.5;
    ctx.filter = 'blur(3px) brightness(150%)';
    ctx.drawImage(img, 50, 200, 150, 100);
    ctx.restore();
};
</script>
</body>
</html>