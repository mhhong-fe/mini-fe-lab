<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Canvas ç­¾å­—æ¿ï¼ˆå¯ä¿å­˜ï¼‰</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #f0f0f0;
    font-family: sans-serif;
    margin: 0;
    padding: 40px;
  }
  canvas {
    border: 2px solid #333;
    background: #fff;
    touch-action: none; /* é˜»æ­¢è§¦æ‘¸æ»šåŠ¨ */
  }
  .toolbar {
    margin-bottom: 10px;
  }
  button {
    padding: 6px 12px;
    margin-right: 6px;
    cursor: pointer;
  }
  #savedImg {
    margin-top: 20px;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<h2>ğŸ–‹ Canvas ç­¾å­—æ¿</h2>
<div class="toolbar">
  <button id="clearBtn">æ¸…ç©º</button>
  <button id="saveBtn">ä¿å­˜ç­¾å</button>
</div>
<canvas id="canvas" width="600" height="400"></canvas>
<h3>ä¿å­˜çš„ç­¾åé¢„è§ˆï¼š</h3>
<img id="savedImg" width="300" />

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const savedImg = document.getElementById('savedImg');

let drawing = false;
let lastX = 0, lastY = 0;

// è®¾ç½®çº¿æ¡æ ·å¼
ctx.lineWidth = 2;
ctx.lineJoin = 'round';
ctx.lineCap = 'round';
ctx.strokeStyle = '#000';

// åæ ‡è½¬æ¢ï¼ˆæ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸ï¼‰
function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  if (e.touches) {
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  } else {
    return {
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    };
  }
}

// å¼€å§‹ç»˜åˆ¶
function startDraw(e) {
  drawing = true;
  const pos = getPos(e);
  lastX = pos.x;
  lastY = pos.y;
}

// ç»˜åˆ¶è·¯å¾„
function draw(e) {
  if (!drawing) return;
  e.preventDefault(); // é˜»æ­¢è§¦æ‘¸æ»šåŠ¨
  const pos = getPos(e);
  ctx.beginPath();
  ctx.moveTo(lastX, lastY);
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();
  lastX = pos.x;
  lastY = pos.y;
}

// ç»“æŸç»˜åˆ¶
function endDraw() {
  drawing = false;
}

// æ¸…ç©ºç”»å¸ƒ
document.getElementById('clearBtn').addEventListener('click', () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  savedImg.src = ''; // æ¸…ç©ºé¢„è§ˆ
});

// ä¿å­˜ç­¾å
document.getElementById('saveBtn').addEventListener('click', () => {
  const dataURL = canvas.toDataURL('image/png');
  savedImg.src = dataURL;
});

// äº‹ä»¶ç»‘å®š
canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', endDraw);
canvas.addEventListener('mouseout', endDraw);

// æ”¯æŒè§¦æ‘¸å±
canvas.addEventListener('touchstart', startDraw);
canvas.addEventListener('touchmove', draw);
canvas.addEventListener('touchend', endDraw);
canvas.addEventListener('touchcancel', endDraw);
</script>

</body>
</html>